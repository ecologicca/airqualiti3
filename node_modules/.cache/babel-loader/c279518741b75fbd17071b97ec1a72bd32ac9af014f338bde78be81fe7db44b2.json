{"ast":null,"code":"var _jsxFileName = \"/Users/caseyreid/Documents/GitHub/airqualiti3/src/pages/dashboard/Dashboard.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../../supabaseClient';\nimport PM25Chart from '../../components/charts/PM25Chart';\nimport PM10Chart from '../../components/charts/PM10Chart';\nimport CityComparisonChart from '../../components/charts/CityComparisonChart';\nimport HealthImpactAnalysis from '../../components/HealthImpactAnalysis';\nimport '../../styles/style.css';\n\n// Utility function for deeper sleep calculation\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst calculateDeeperSleepMinutes = (data, hasEcologica) => {\n  const getAdjustedValue = value => {\n    // Always apply indoor reduction first\n    const indoorValue = value * 0.7;\n    // Then apply Ecologica if present\n    if (hasEcologica) return value * 0.5;\n    return indoorValue;\n  };\n  const daysUnderThreshold = data.filter(day => {\n    const adjustedValue = getAdjustedValue(parseFloat(day['PM 2.5']));\n    return adjustedValue <= 5;\n  }).length;\n  return daysUnderThreshold * 8 * 60;\n};\nconst Dashboard = () => {\n  _s();\n  const [data, setData] = useState([]);\n  const [userPreferences, setUserPreferences] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  useEffect(() => {\n    const fetchUserPreferences = async () => {\n      try {\n        const {\n          data: {\n            user\n          }\n        } = await supabase.auth.getUser();\n        if (!user) return;\n        const {\n          data: preferences,\n          error\n        } = await supabase.from('user_preferences').select('*').eq('user_id', user.id).single();\n        if (error) throw error;\n        setUserPreferences(preferences);\n      } catch (error) {\n        console.error('Error fetching user preferences:', error);\n      }\n    };\n    const fetchAirQualityData = async () => {\n      try {\n        if (!(userPreferences !== null && userPreferences !== void 0 && userPreferences.city)) return;\n        const {\n          data: airData,\n          error\n        } = await supabase.from('weather_data').select('*').eq('city', userPreferences.city).order('created_at', {\n          ascending: false\n        }).limit(30);\n        if (error) throw error;\n\n        // Transform the data to ensure consistent format\n        const transformedData = airData.map(item => ({\n          ...item,\n          'PM 2.5': item.pm25 || item['PM 2.5'],\n          'PM 10': item.pm10 || item['PM 10'],\n          date: new Date(item.created_at || item.date)\n        }));\n        setData(transformedData);\n      } catch (error) {\n        console.error('Error fetching air quality data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchUserPreferences();\n\n    // Only fetch air quality data when we have user preferences\n    if (userPreferences !== null && userPreferences !== void 0 && userPreferences.city) {\n      fetchAirQualityData();\n    }\n    const interval = setInterval(() => {\n      if (userPreferences !== null && userPreferences !== void 0 && userPreferences.city) {\n        fetchAirQualityData();\n      }\n    }, 60 * 60 * 1000); // Refresh every hour\n\n    return () => clearInterval(interval);\n  }, [userPreferences === null || userPreferences === void 0 ? void 0 : userPreferences.city]);\n  if (isLoading || !userPreferences) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 45\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"dashboard\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"dashboard-title\",\n      children: [userPreferences.first_name ? `${userPreferences.first_name}'s ` : '', \"Air Quality Dashboard\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"dashboard-content\",\n      children: [/*#__PURE__*/_jsxDEV(HealthImpactAnalysis, {\n        data: data,\n        userPreferences: userPreferences\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"charts-grid\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chart-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"PM2.5 Levels\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PM25Chart, {\n            data: data,\n            userPreferences: userPreferences\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chart-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"PM10 Levels\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PM10Chart, {\n            data: data,\n            userPreferences: userPreferences\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chart-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"City Comparison\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CityComparisonChart, {\n            data: data,\n            userPreferences: userPreferences\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n};\n_s(Dashboard, \"4kIiW16JRnMfRS/ZxQQYKoKe24M=\");\n_c = Dashboard;\nexport default Dashboard;\nvar _c;\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"names":["React","useState","useEffect","supabase","PM25Chart","PM10Chart","CityComparisonChart","HealthImpactAnalysis","jsxDEV","_jsxDEV","calculateDeeperSleepMinutes","data","hasEcologica","getAdjustedValue","value","indoorValue","daysUnderThreshold","filter","day","adjustedValue","parseFloat","length","Dashboard","_s","setData","userPreferences","setUserPreferences","isLoading","setIsLoading","fetchUserPreferences","user","auth","getUser","preferences","error","from","select","eq","id","single","console","fetchAirQualityData","city","airData","order","ascending","limit","transformedData","map","item","pm25","pm10","date","Date","created_at","interval","setInterval","clearInterval","children","fileName","_jsxFileName","lineNumber","columnNumber","className","first_name","_c","$RefreshReg$"],"sources":["/Users/caseyreid/Documents/GitHub/airqualiti3/src/pages/dashboard/Dashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase } from '../../supabaseClient';\nimport PM25Chart from '../../components/charts/PM25Chart';\nimport PM10Chart from '../../components/charts/PM10Chart';\nimport CityComparisonChart from '../../components/charts/CityComparisonChart';\nimport HealthImpactAnalysis from '../../components/HealthImpactAnalysis';\nimport '../../styles/style.css';\n\n// Utility function for deeper sleep calculation\nconst calculateDeeperSleepMinutes = (data, hasEcologica) => {\n  const getAdjustedValue = (value) => {\n    // Always apply indoor reduction first\n    const indoorValue = value * 0.7;\n    // Then apply Ecologica if present\n    if (hasEcologica) return value * 0.5;\n    return indoorValue;\n  };\n\n  const daysUnderThreshold = data.filter(day => {\n    const adjustedValue = getAdjustedValue(parseFloat(day['PM 2.5']));\n    return adjustedValue <= 5;\n  }).length;\n\n  return daysUnderThreshold * 8 * 60;\n};\n\nconst Dashboard = () => {\n  const [data, setData] = useState([]);\n  const [userPreferences, setUserPreferences] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchUserPreferences = async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return;\n\n        const { data: preferences, error } = await supabase\n          .from('user_preferences')\n          .select('*')\n          .eq('user_id', user.id)\n          .single();\n\n        if (error) throw error;\n        setUserPreferences(preferences);\n      } catch (error) {\n        console.error('Error fetching user preferences:', error);\n      }\n    };\n\n    const fetchAirQualityData = async () => {\n      try {\n        if (!userPreferences?.city) return;\n\n        const { data: airData, error } = await supabase\n          .from('weather_data')\n          .select('*')\n          .eq('city', userPreferences.city)\n          .order('created_at', { ascending: false })\n          .limit(30);\n\n        if (error) throw error;\n        \n        // Transform the data to ensure consistent format\n        const transformedData = airData.map(item => ({\n          ...item,\n          'PM 2.5': item.pm25 || item['PM 2.5'],\n          'PM 10': item.pm10 || item['PM 10'],\n          date: new Date(item.created_at || item.date)\n        }));\n\n        setData(transformedData);\n      } catch (error) {\n        console.error('Error fetching air quality data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchUserPreferences();\n\n    // Only fetch air quality data when we have user preferences\n    if (userPreferences?.city) {\n      fetchAirQualityData();\n    }\n\n    const interval = setInterval(() => {\n      if (userPreferences?.city) {\n        fetchAirQualityData();\n      }\n    }, 60 * 60 * 1000); // Refresh every hour\n\n    return () => clearInterval(interval);\n  }, [userPreferences?.city]);\n\n  if (isLoading || !userPreferences) return <div>Loading...</div>;\n\n  return (\n    <div className=\"dashboard\">\n      <h1 className=\"dashboard-title\">\n        {userPreferences.first_name ? `${userPreferences.first_name}'s ` : ''}\n        Air Quality Dashboard\n      </h1>\n\n      <div className=\"dashboard-content\">\n        <HealthImpactAnalysis data={data} userPreferences={userPreferences} />\n        \n        <div className=\"charts-grid\">\n          <div className=\"chart-section\">\n            <h2>PM2.5 Levels</h2>\n            <PM25Chart data={data} userPreferences={userPreferences} />\n          </div>\n\n          <div className=\"chart-section\">\n            <h2>PM10 Levels</h2>\n            <PM10Chart data={data} userPreferences={userPreferences} />\n          </div>\n\n          <div className=\"chart-section\">\n            <h2>City Comparison</h2>\n            <CityComparisonChart data={data} userPreferences={userPreferences} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Dashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}